<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal DNS Benchmark</title>
    <style>
        /* Keep the same CSS from previous version */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            text-align: center;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 10px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .results-section {
            padding: 30px;
            display: none;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .results-table th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .results-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .results-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status.working {
            background-color: #d5f4e6;
            color: #27ae60;
        }

        .status.failed {
            background-color: #fadbd8;
            color: #c0392b;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üåê Universal DNS Benchmark</h1>
            <p>Test DNS performance using multiple methods</p>
        </div>

        <div class="controls">
            <div class="warning">
                <strong>‚ö†Ô∏è Browser Limitations:</strong> Due to CORS and security restrictions, only Google and
                Cloudflare DNS typically work in browsers. For complete testing, use the command-line version.
            </div>

            <div class="info">
                <strong>üí° Alternative Methods:</strong>
                <br>‚Ä¢ <strong>Method 1:</strong> Image loading test (measures network routing)
                <br>‚Ä¢ <strong>Method 2:</strong> DoH API testing (limited providers)
                <br>‚Ä¢ <strong>Method 3:</strong> Fetch timing test (indirect DNS measurement)
            </div>

            <button class="btn" onclick="testMethod1()">üì° Test Network Routing</button>
            <button class="btn" onclick="testMethod2()">üîç Test DoH APIs</button>
            <button class="btn" onclick="generateScript()">üìã Generate Script</button>
        </div>

        <div class="results-section" id="resultsSection">
            <h2>üìä Test Results</h2>
            <table class="results-table">
                <thead>
                    <tr>
                        <th>DNS Provider</th>
                        <th>IP Address</th>
                        <th>DoH API</th>
                        <th>Network Test</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="resultsBody">
                </tbody>
            </table>
        </div>

        <div id="scriptSection" style="display: none; padding: 30px;">
            <h2>üìã Copy this script to test all DNS servers:</h2>
            <textarea id="scriptOutput"
                style="width: 100%; height: 200px; font-family: monospace; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px;"
                readonly></textarea>
            <br><br>
            <button class="btn" onclick="copyScript()">üìã Copy Script</button>
            <div style="margin-top: 15px; color: #7f8c8d;">
                <strong>Instructions:</strong>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Copy the script above</li>
                    <li>Open Terminal/Command Prompt/WSL</li>
                    <li>Paste and run the script</li>
                    <li>Copy results back to the HTML analyzer</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        const DNS_SERVERS = [
            {
                name: "Google",
                ip: "8.8.8.8",
                doh: "https://dns.google/resolve",
                test_domain: "dns.google"
            },
            {
                name: "Cloudflare",
                ip: "1.1.1.1",
                doh: "https://cloudflare-dns.com/dns-query",
                test_domain: "one.one.one.one"
            },
            {
                name: "OpenDNS",
                ip: "208.67.222.222",
                doh: "https://doh.opendns.com/dns-query",
                test_domain: "welcome.opendns.com"
            },
            {
                name: "Quad9",
                ip: "9.9.9.9",
                doh: "https://dns.quad9.net/dns-query",
                test_domain: "quad9.net"
            },
            {
                name: "NextDNS",
                ip: "45.90.28.0",
                doh: "https://dns.nextdns.io",
                test_domain: "nextdns.io"
            },
            {
                name: "AdGuard",
                ip: "94.140.14.14",
                doh: "https://dns.adguard.com/dns-query",
                test_domain: "adguard.com"
            },
            {
                name: "Kahf",
                ip: "40.120.32.170",
                doh: null,
                test_domain: "kahfguard.com"
            }
        ];

        async function testMethod1() {
            document.getElementById('resultsSection').style.display = 'block';
            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';

            // Updated DNS servers with optimized test endpoints
            const DNS_SERVERS_FAIR = [
                {
                    name: "Google",
                    ip: "8.8.8.8",
                    test_endpoints: ["https://google.com/robots.txt", "https://dns.google/"]
                },
                {
                    name: "Cloudflare",
                    ip: "1.1.1.1",
                    test_endpoints: ["https://1.1.1.1/robots.txt", "https://1.1.1.1/"]
                },
                {
                    name: "OpenDNS",
                    ip: "208.67.222.222",
                    test_endpoints: ["https://www.opendns.com/robots.txt", "https://www.opendns.com/"]
                },
                {
                    name: "Quad9",
                    ip: "9.9.9.9",
                    test_endpoints: ["https://quad9.net/robots.txt", "https://quad9.net/"]
                },
                {
                    name: "NextDNS",
                    ip: "45.90.28.0",
                    test_endpoints: ["https://nextdns.io/robots.txt", "https://nextdns.io/"]
                },
                {
                    name: "AdGuard",
                    ip: "94.140.14.14",
                    test_endpoints: ["https://adguard.com/robots.txt", "https://adguard.com/"]
                },
                {
                    name: "Kahf",
                    ip: "40.120.32.170",
                    test_endpoints: ["https://kahf.com/robots.txt", "https://kahf.com/"]
                }
            ];

            for (const server of DNS_SERVERS_FAIR) {
                const row = document.createElement('tr');

                let networkResult = 'Testing...';
                let networkStatus = 'failed';
                let testMethod = '';

                // Update the row immediately to show "Testing..."
                row.innerHTML = `
            <td><strong>${server.name}</strong></td>
            <td>${server.ip}</td>
            <td>-</td>
            <td>${networkResult}</td>
            <td><span class="status failed">Testing...</span></td>
        `;
                tbody.appendChild(row);

                // Test multiple endpoints for fairness
                let bestTime = Infinity;
                let workingEndpoint = null;

                for (const endpoint of server.test_endpoints) {
                    try {
                        const startTime = performance.now();

                        // Use HEAD request to avoid content size bias
                        const response = await fetch(endpoint, {
                            method: 'HEAD',           // üîë No content download
                            mode: 'no-cors',         // Bypass CORS
                            cache: 'no-cache',       // Avoid cache bias
                            signal: AbortSignal.timeout(4000)
                        });

                        const endTime = performance.now();
                        const responseTime = endTime - startTime;

                        // Keep the fastest successful response
                        if (responseTime < bestTime) {
                            bestTime = responseTime;
                            workingEndpoint = endpoint;
                            networkStatus = 'working';
                        }

                        // If we get a very fast response, no need to test other endpoints
                        if (responseTime < 100) break;

                    } catch (error) {
                        // Continue to next endpoint
                        continue;
                    }

                    // Small delay between endpoint tests
                    await new Promise(resolve => setTimeout(resolve, 50));
                }

                // Determine final result
                if (networkStatus === 'working') {
                    networkResult = `${Math.round(bestTime)}ms`;
                    testMethod = workingEndpoint.includes('robots.txt') ? 'robots.txt' : 'homepage';
                } else {
                    networkResult = 'Unreachable';
                    testMethod = 'failed';
                }

                // Update the row with final results
                row.innerHTML = `
            <td><strong>${server.name}</strong></td>
            <td>${server.ip}</td>
            <td>-</td>
            <td>${networkResult} <small>(${testMethod})</small></td>
            <td><span class="status ${networkStatus}">${networkStatus === 'working' ? 'Reachable' : 'Failed'}</span></td>
        `;
            }

            // Add explanation after all tests complete
            setTimeout(() => {
                const explanationRow = document.createElement('tr');
                explanationRow.innerHTML = `
            <td colspan="5" style="background-color: #f8f9fa; font-style: italic; text-align: center; padding: 10px;">
                <small>üìä <strong>Fair Testing:</strong> Uses HEAD requests and robots.txt files to minimize content size bias. 
                Times represent network latency to DNS provider infrastructure.</small>
            </td>
        `;
                tbody.appendChild(explanationRow);
            }, 1000);
        }

        async function testMethod10() {
            document.getElementById('resultsSection').style.display = 'block';
            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';

            for (const server of DNS_SERVERS) {
                const row = document.createElement('tr');

                // Test network connectivity to provider's domain
                let networkResult = 'Testing...';
                let networkStatus = 'failed';

                try {
                    const startTime = performance.now();

                    const response = await fetch(`https://${server.test_domain}/`, {
                        method: 'HEAD',
                        mode: 'no-cors',
                        signal: AbortSignal.timeout(5000)
                    });

                    const endTime = performance.now();

                    networkResult = `${Math.round(endTime - startTime)}ms`;
                    networkStatus = 'working';
                } catch (error) {
                    networkResult = 'Timeout/Blocked';
                }

                row.innerHTML = `
                    <td><strong>${server.name}</strong></td>
                    <td>${server.ip}</td>
                    <td>-</td>
                    <td>${networkResult}</td>
                    <td><span class="status ${networkStatus}">${networkStatus === 'working' ? 'Reachable' : 'Blocked'}</span></td>
                `;

                tbody.appendChild(row);
            }
        }

        async function testMethod2() {
            document.getElementById('resultsSection').style.display = 'block';
            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';

            for (const server of DNS_SERVERS) {
                const row = document.createElement('tr');

                // Test DoH API
                let dohResult = 'N/A';
                let dohStatus = 'failed';

                if (server.doh) {
                    try {
                        const startTime = performance.now();
                        const response = await fetch(`${server.doh}?name=google.com&type=A`, {
                            method: 'GET',
                            headers: { 'Accept': 'application/dns-json' },
                            signal: AbortSignal.timeout(5000)
                        });
                        const endTime = performance.now();

                        if (response.ok) {
                            dohResult = `${Math.round(endTime - startTime)}ms`;
                            dohStatus = 'working';
                        } else {
                            dohResult = `HTTP ${response.status}`;
                        }
                    } catch (error) {
                        dohResult = 'CORS/Blocked';
                    }
                }

                row.innerHTML = `
                    <td><strong>${server.name}</strong></td>
                    <td>${server.ip}</td>
                    <td>${dohResult}</td>
                    <td>-</td>
                    <td><span class="status ${dohStatus}">${dohStatus === 'working' ? 'Working' : 'Failed'}</span></td>
                `;

                tbody.appendChild(row);
            }
        }

        function generateScript() {
            const script = `#!/bin/bash
# DNS Benchmark Script - Generated by Universal DNS Benchmark Tool
# Run this in Terminal/WSL/Command Prompt with bash support

servers=("8.8.8.8" "1.1.1.1" "208.67.222.222" "9.9.9.9" "45.90.28.0" "94.140.14.14" "40.120.32.170")
names=("Google" "Cloudflare" "OpenDNS" "Quad9" "NextDNS" "AdGuard" "Kahf")

echo "üöÄ Starting DNS Benchmark..."
echo "Testing \${#servers[@]} DNS servers"
echo "=================================="

for i in "\${!servers[@]}"; do
    echo "Testing \${names[\$i]} (\${servers[\$i]}):"
    time dig @\${servers[\$i]} google.com +short
    echo "---"
done

echo "=================================="
echo "‚úÖ Benchmark Complete!"
echo "Copy the results above and paste them into the HTML analyzer for ranking."`;

            document.getElementById('scriptOutput').value = script;
            document.getElementById('scriptSection').style.display = 'block';
        }

        function copyScript() {
            const textarea = document.getElementById('scriptOutput');
            textarea.select();
            document.execCommand('copy');
            alert('Script copied to clipboard! üìã');
        }
    </script>
</body>

</html>